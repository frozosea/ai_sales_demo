<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipecat LOCAL Tester</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 2rem; background: #282c34; color: white; }
        #status { font-size: 1.2rem; margin-bottom: 1rem; padding: 10px; border-radius: 5px; }
        .disconnected { background-color: #721c24; }
        .connecting { background-color: #856404; }
        .connected { background-color: #155724; }
        button { font-size: 1.2rem; padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; }
    </style>
    <script src="https://unpkg.com/@pipecat-ai/client-js@0.1.31/dist/pipecat-client.js"></script>
    <script src="https://unpkg.com/@pipecat-ai/websocket-transport-js@0.1.31/dist/websocket-transport.js"></script>
</head>
<body>
    <h1>Pipecat Local Transport Test</h1>
    <div id="status" class="disconnected">Status: Disconnected</div>
    <button id="connectBtn">Connect and Start</button>

    <script>
        // üëá –í–ï–°–¨ –ù–ê–® –ö–û–î –¢–ï–ü–ï–†–¨ –í–ù–£–¢–†–ò –≠–¢–û–ì–û –û–ë–†–ê–ë–û–¢–ß–ò–ö–ê
        document.addEventListener('DOMContentLoaded', () => {
            const connectBtn = document.getElementById('connectBtn');
            const statusDiv = document.getElementById('status');

            let pipecatClient = null;

            const setStatus = (text, className) => {
                statusDiv.textContent = `Status: ${text}`;
                statusDiv.className = className;
            };

            const connect = async () => {
                if (pipecatClient && pipecatClient.isConnected) {
                    console.log("Disconnecting...");
                    await pipecatClient.disconnect();
                    return;
                }

                console.log("Initializing Pipecat Client for LOCAL transport...");
                setStatus("Initializing...", "connecting");

                // –°–æ–∑–¥–∞–µ–º WebSocket-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, —É–∫–∞–∑—ã–≤–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç
                const transport = new Pipecat.WebsocketTransport({
                    url: "ws://localhost:8765/ws"
                });

                // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç Pipecat
                pipecatClient = new Pipecat.PipecatClient({
                    transport: transport,
                    enableMic: true,
                    callbacks: {
                        onConnected: () => {
                            console.log("[CALLBACK] Connected to local WebSocket");
                            setStatus("Connected", "connected");
                            connectBtn.textContent = "Disconnect";
                        },
                        onDisconnected: () => {
                            console.log("[CALLBACK] Disconnected");
                            setStatus("Disconnected", "disconnected");
                            connectBtn.textContent = "Connect and Start";
                        },
                        onError: (error) => {
                            console.error("[CALLBACK] An error occurred:", error);
                            setStatus(`Error: ${error.message}`, "disconnected");
                        }
                    }
                });

                try {
                    // –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è
                    console.log("Connecting to local server...");
                    setStatus("Connecting...", "connecting");
                    await pipecatClient.connect();
                } catch (e) {
                    console.error("Failed to connect:", e);
                    setStatus(`Connection Failed: ${e.message}`, "disconnected");
                }
            };

            connectBtn.addEventListener('click', connect);
        });
    </script>
</body>
</html>