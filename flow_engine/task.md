
üß© –ó–∞–¥–∞—á–∞ FE-01 ‚Äî –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è: goals.json + dialogue_map.json + –≤—ã—Ä–∞–∂–µ–Ω–∏—è is_required

–¶–µ–ª—å. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ö–µ–º—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –±–µ–∑–æ–ø–∞—Å–Ω—É—é –æ—Ü–µ–Ω–∫—É —É—Å–ª–æ–≤–∏–π –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é, —á—Ç–æ–±—ã –≤–µ—Å—å –¥–≤–∏–∂–æ–∫ –æ–ø–∏—Ä–∞–ª—Å—è –Ω–∞ JSON-–¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ –Ω–∞ ‚Äúif-–≤–µ—Ç–∫–∏‚Äù –≤ –∫–æ–¥–µ.

–ö–æ–Ω—Ç–µ–∫—Å—Ç

FlowEngine ‚Äî stateless-singleton. –û–Ω –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ 2 —Ñ–∞–π–ª–∞:
	‚Ä¢	configs/goals.json ‚Äî —Ü–µ–ª–∏ –∏ —Ç—Ä–µ–±—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å–ª–æ—Ç—ã) —Å —É—Å–ª–æ–≤–∏—è–º–∏.
	‚Ä¢	configs/dialogue_map.json ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ä–µ–ø–ª–∏–∫/–º–∏–∫—Ä–æ—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

–ù—É–∂–Ω—ã:
	‚Ä¢	–Ø–≤–Ω—ã–µ —Å—Ö–µ–º—ã (–æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π/—Ç–∏–ø–æ–≤).
	‚Ä¢	–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –≤ next_state:
	‚Ä¢	RUN_FORCE_CHECK ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–º—É –∏ –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—É –≤ —Ñ–æ—Ä—Å-—Ä–µ–∂–∏–º–µ.
	‚Ä¢	RESUME_PREVIOUS_TASK ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–∞—É–∑–Ω—É—Ç–æ–π –∑–∞–¥–∞—á–µ (FlowEngine —Å–∞–º –≤—ã—á–∏—Å–ª–∏—Ç –∫—É–¥–∞).
	‚Ä¢	–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π is_required:
	‚Ä¢	–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤–∏–¥–∞:
session.variables.wants_inner_insurance == true
	‚Ä¢	–£—á–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–Ω–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –±—É–ª–µ–≤—ã/—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ session.variables, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ "–¥–∞"/"–Ω–µ—Ç" ‚Üí True/False, "0"/"1" ‚Üí int):
	‚Ä¢	–í–≤–µ–¥–µ–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ fn boolish(value), fn num(value), fn var("name", default=None) –≤ –º–∏–Ω–∏-—è–∑—ã–∫–µ —É—Å–ª–æ–≤–∏–π.
	‚Ä¢	–í—Å–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ: —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∏–º–µ–Ω–∞/—Ñ—É–Ω–∫—Ü–∏–∏, –∑–∞–ø—Ä–µ—Ç –ª—é–±—ã—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

–§–∞–π–ª—ã
	‚Ä¢	flow_engine/schemas.py ‚Äî —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä (—Å–ª–æ–≤–∞–º–∏, –±–µ–∑ –∫–æ–¥–∞).
	‚Ä¢	configs/goals.json ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –Ω–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä (—Å–º. –Ω–∏–∂–µ).
	‚Ä¢	configs/dialogue_map.json ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä (—Å–º. –Ω–∏–∂–µ).
	‚Ä¢	scripts/validate_dialogue_map.py ‚Äî (–æ–ø–∏—Å–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç).
	‚Ä¢	scripts/validate_goals.py ‚Äî (–æ–ø–∏—Å–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç).

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º

goals.json (–ø—Ä–∏–º–µ—Ä)

{
  "provide_total_price": {
    "is_terminal": false,
    "is_digression": false,
    "is_forcing": false,
    "parameters": [
      {
        "name": "wants_inner_insurance",
        "is_required": true,
        "dialogue_state_to_ask": "ask_if_wants_inner_insurance",
        "force_dialogue_state_to_ask": "force_ask_if_wants_inner_insurance"
      },
      {
        "name": "property_value",
        "is_required": true,
        "dialogue_state_to_ask": "ask_property_value",
        "force_dialogue_state_to_ask": "force_ask_property_value"
      },
      {
        "name": "inner_amount",
        "is_required": "boolish(var('wants_inner_insurance')) == true",
        "dialogue_state_to_ask": "ask_inner_amount",
        "force_dialogue_state_to_ask": "force_ask_inner_amount"
      }
    ],
    "result_state": "summary_total_price"
  },

  "handle_faq_ask_company": {
    "is_terminal": false,
    "is_digression": true,
    "is_forcing": false,
    "result_state": "info_company"
  },

  "handle_rejection": {
    "is_terminal": true,
    "is_digression": false,
    "is_forcing": false,
    "result_state": "refusal_end"
  },

  "demand_final_answer_cost": {
    "is_terminal": false,
    "is_digression": false,
    "is_forcing": true
  }
}

dialogue_map.json (–ø—Ä–∏–º–µ—Ä)

{
  "ask_property_value": {
    "description": "–ó–∞–ø—Ä–æ—Å —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏",
    "system_response": {
      "playlist": [
        { "type": "tts", "text_template": "–ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –Ω–∞ –∫–∞–∫—É—é —Å—É–º–º—É –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ –≤–∞—à—É –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å?" }
      ]
    },
    "transitions": {
      "provide_number": {
        "next_state": "RUN_FORCE_CHECK",
        "execute_code": "session.variables['property_value'] = entities['value']"
      },
      "confirm_no": {
        "next_state": "ask_property_value_refine"
      }
    }
  },

  "force_ask_property_value": {
    "system_response": {
      "playlist": [
        { "type": "tts", "text_template": "–ß—Ç–æ–±—ã –Ω–∞–∑–≤–∞—Ç—å —Ü–µ–Ω—É, —É–∫–∞–∂–∏—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏." }
      ]
    },
    "transitions": {
      "provide_number": {
        "next_state": "RUN_FORCE_CHECK",
        "execute_code": "session.variables['property_value'] = entities['value']"
      }
    }
  },

  "info_company": {
    "system_response": {
      "playlist": [ { "type": "cache", "key": "static:about_company" } ]
    },
    "transitions": {
      "return_to_main_goal": { "next_state": "RESUME_PREVIOUS_TASK" }
    }
  },

  "refusal_end": {
    "action": "END_CALL",
    "system_response": {
      "playlist": [ { "type": "cache", "key": "static:polite_goodbye" } ]
    },
    "transitions": {}
  },

  "summary_total_price": {
    "system_response": {
      "playlist": [
        { "type": "tts", "text_template": "–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: {{ session.variables.total_price }} —Ä—É–±–ª–µ–π." }
      ]
    },
    "transitions": { "confirm_yes": { "next_state": "refusal_end" } }
  }
}

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
	‚Ä¢	–°—Ö–µ–º—ã/–æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ next_state.
	‚Ä¢	–í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤, –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏–Ω—Ç–µ–Ω—Ç–æ–≤ –≤ transitions, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –º–∏–Ω–∏-—è–∑—ã–∫–∞ is_required.
	‚Ä¢	–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∏–Ω–∏-—è–∑—ã–∫–∞ –∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: boolish, num, var.

‚∏ª

üß© –ó–∞–¥–∞—á–∞ FE-02 ‚Äî –Ø–¥—Ä–æ FlowEngine: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, —Å—Ç–µ–∫ –∑–∞–¥–∞—á, —Å—Ç–∞—Çeless-—Ä–∞–±–æ—Ç–∞

–¶–µ–ª—å. –§–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ process_event(session_state, intent_id, entities?) ‚Üí FlowResult –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –ª–µ—Å—Ç–Ω–∏—Ü–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å—Ç–µ–∫–æ–º –∑–∞–¥–∞—á.

–ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤:
	0.	–¢–µ—Ä–º–∏–Ω–∞–ª (goal.is_terminal): –æ—á–∏—Å—Ç–∫–∞ task_stack, –ø—É—à —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏, next_state = goal.result_state.
	1.	–§–æ—Ä—Å-–∏–Ω—Ç–µ–Ω—Ç (goal.is_forcing): –ø–µ—Ä–µ–π—Ç–∏ –≤ –±—ã—Å—Ç—Ä—ã–π —Å–±–æ—Ä –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–µ–ª–∏, mode='FORCED', next_state = *force_ask_*.
	2.	–í–æ–∑–≤—Ä–∞—Ç –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é (intent_id == return_to_main_goal): pop() —Å–≤–µ—Ä—Ö—É –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ-PAUSED –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–¥–∞—á–∏, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.
	3.	–î–∏–≥—Ä–µ—Å—Å–∏—è/FAQ (goal.is_digression): —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É PAUSED, –ø—É—à –Ω–æ–≤–æ–π FAQ-–∑–∞–¥–∞—á–∏, next_state = goal.result_state. –§–ª–∞–≥ should_guide_back –ø—Ä–∏ –≥–ª—É–±–∏–Ω–µ > N.
	4.	Happy-path —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏: –ø—Ä–∏–º–µ–Ω–∏—Ç—å transitions –ø–æ dialogue_map –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∏–ª–∏ —à–∞–≥–∞), –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å execute_code, –≤–µ—Ä–Ω—É—Ç—å next_state.

–§–∞–π–ª—ã
	‚Ä¢	flow_engine/engine.md ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç process_event, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ FlowResult (–ø–æ–ª—è), —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤.
	‚Ä¢	flow_engine/models.md ‚Äî –º–æ–¥–µ–ª—å Task/SessionState.task_stack (—Å–ª–æ–≤–∞–º–∏).
	‚Ä¢	flow_engine/test/test_priorities.md ‚Äî —Å—Ü–µ–Ω–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ –∫–æ–¥–∞.

FlowResult (–∫–æ–Ω—Ç—Ä–∞–∫—Ç)
	‚Ä¢	status: SUCCESS | MISSING_ENTITY | EXECUTION_ERROR
	‚Ä¢	next_state: str | null
	‚Ä¢	updated_session: —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã–π —Å—Ä–µ–∑ session_state (–º–∏–Ω–∏–º—É–º: variables, task_stack –≤ –ø–ª–æ—Å–∫–æ–º –≤–∏–¥–µ)
	‚Ä¢	flags: { "should_guide_back": bool, "ended": bool } (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º (–ø—Ä–æ–≤–µ—Ä—è–µ–º)
	1.	–ù–µ—Ç–µ—Ä–ø–µ–ª–∏–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí —Ñ–æ—Ä—Å-—Ä–µ–∂–∏–º (—Å–º. –Ω–∏–∂–µ –≤ FE-03).
	2.	–î–≤–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ FAQ ‚Üí —Å—Ç–µ–∫ PAUSED/IN_PROGRESS, –≤–æ–∑–≤—Ä–∞—Ç.
	3.	–û—Ç–∫–∞–∑ ‚Üí —Ç–µ—Ä–º–∏–Ω–∞–ª: –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–µ–∫–∞, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ refusal_end.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
	‚Ä¢	–û–ø–∏—Å–∞–Ω–∞ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞ —Å—Ö–µ–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ FlowResult.
	‚Ä¢	–û–ø–∏—Å–∞–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ç–µ–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ.
	‚Ä¢	–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã —Å—Ü–µ–Ω–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã (—Å–ª–æ–≤–∞–º–∏, —Å –≤—Ö–æ–¥–∞–º–∏/–≤—ã—Ö–æ–¥–∞–º–∏) –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.

‚∏ª

üß© –ó–∞–¥–∞—á–∞ FE-03 ‚Äî –§–æ—Ä—Å-—Ä–µ–∂–∏–º –∏ RUN_FORCE_CHECK: –±—ã—Å—Ç—Ä—ã–π —Å–±–æ—Ä –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤

–¶–µ–ª—å. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –±—ã—Å—Ç—Ä–æ–≥–æ —Å–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ü–µ–ª–∏ –ø—Ä–∏ –¥–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äú–°–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É —Å–µ–π—á–∞—Å‚Äù). FlowEngine –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∏ –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —Å–ª–æ—Ç, —É—á–∏—Ç—ã–≤–∞—è —É—Å–ª–æ–≤–∏—è is_required.

–ö–æ–Ω—Ç–µ–∫—Å—Ç
	‚Ä¢	–í goals.json —É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –µ—Å—Ç—å:
	‚Ä¢	is_required: true | <expr>
	‚Ä¢	dialogue_state_to_ask / force_dialogue_state_to_ask
	‚Ä¢	–ö–æ–≥–¥–∞ –≤ –¥–∏–∞–ª–æ–≥–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç is_forcing: true –∏–ª–∏ dialogue_map –≤–µ—Ä–Ω—É–ª next_state: "RUN_FORCE_CHECK", FlowEngine –¥–æ–ª–∂–µ–Ω:
	1.	–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å–ª–æ—Ç–æ–≤ —Å —É—á—ë—Ç–æ–º is_required (–∏—Å–ø–æ–ª—å–∑—É—è –º–∏–Ω–∏-—è–∑—ã–∫ –∏–∑ FE-01).
	2.	–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–µ, —á—Ç–æ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ session.variables.
	3.	–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∑–∞–ø–æ–ª–Ω—ë–Ω–Ω—ã–µ ‚Äî –≤–µ—Ä–Ω—É—Ç—å –∏—Ö —Ñ–æ—Ä—Å-—Å–æ—Å—Ç–æ—è–Ω–∏–µ (force_dialogue_state_to_ask).
	4.	–ï—Å–ª–∏ –≤—Å–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ‚Äî –≤–µ—Ä–Ω—É—Ç—å result_state —Ü–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, summary_total_price) –∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–≤ —Ä–∞–º–∫–∞—Ö Orchestrator —ç—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤).

–§–∞–π–ª—ã
	‚Ä¢	flow_engine/force_mode.md ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –ø—Å–µ–≤–¥–æ–ø–æ—Ç–æ–∫.
	‚Ä¢	–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ configs/goals.json ‚Äî –Ω–∞–ª–∏—á–∏–µ force_dialogue_state_to_ask —É –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.
	‚Ä¢	flow_engine/test/test_force_mode.md ‚Äî —Ç–µ—Å—Ç-–∫–µ–π—Å—ã.

–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
	‚Ä¢	–í—Ö–æ–¥: intent_id="demand_final_answer_cost", session.variables={}, —Å—Ç–µ–∫ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç Task(goal_id='provide_total_price', status='IN_PROGRESS').
‚Üí –í—ã—Ö–æ–¥: next_state="force_ask_property_value".
	‚Ä¢	–í—Ö–æ–¥: dialogue_map –ø–µ—Ä–µ—Ö–æ–¥ provide_number ‚Üí RUN_FORCE_CHECK, session.variables.property_value=5000000, wants_inner_insurance=true, inner_amount –ø—É—Å—Ç.
‚Üí –í—ã—Ö–æ–¥: next_state="force_ask_inner_amount".

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
	‚Ä¢	–û–ø–∏—Å–∞–Ω –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –æ–¥–Ω–æ–≥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–æ—Ç–∞.
	‚Ä¢	–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–π (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ: –Ω–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–º–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ session.variables.

‚∏ª

üß© –ó–∞–¥–∞—á–∞ FE-04 ‚Äî –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ dialogue_map –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞: –ø–ª–µ–π–ª–∏—Å—Ç—ã, execute_code, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

–¶–µ–ª—å. –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ/–ø–µ—Ä–µ—Ö–æ–¥ dialogue_map –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è Orchestrator: —á—Ç–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å (playlist), –∫–∞–∫–æ–π next_state, –Ω—É–∂–Ω–æ –ª–∏ –¥–ª–∏–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∏ —Ç. –ø.

–ö–æ–Ω—Ç–µ–∫—Å—Ç
	‚Ä¢	dialogue_map[state_id] —Å–æ–¥–µ—Ä–∂–∏—Ç:
	‚Ä¢	system_response.playlist ‚Äî —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ cache / filler / tts —Å —à–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏–µ–π ({{ session.variables.* }}).
	‚Ä¢	transitions[intent_id] ‚Äî next_state –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ execute_code.
	‚Ä¢	long_operation: bool (–æ–ø—Ü–∏—è; –µ—Å–ª–∏ true ‚Äî –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å —Ñ–∏–ª–ª–µ—Ä–∞–º–∏).
	‚Ä¢	action: "END_CALL" (–¥–ª—è —Ñ–∏–Ω–∞–ª–∞).
	‚Ä¢	FlowEngine –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
	‚Ä¢	next_state (–∫—É–¥–∞ –ø–µ—Ä–µ–π—Ç–∏),
	‚Ä¢	response (–ø–∞–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π Orchestrator –æ—Ç–¥–∞—Å—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—é –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤),
	‚Ä¢	—Ñ–ª–∞–≥–∏ (ended), –µ—Å–ª–∏ –∑–∞–¥–∞–Ω action.

–§–∞–π–ª—ã
	‚Ä¢	flow_engine/response_contract.md ‚Äî —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç FlowEngine –∫ Orchestrator (—Å–ª–æ–≤–∞–º–∏).
	‚Ä¢	–ü—Ä–∏–º–µ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ configs/dialogue_map.json —Å long_operation.
	‚Ä¢	flow_engine/test/test_dialogue_response.md ‚Äî —Ç–µ—Å—Ç-–∫–µ–π—Å—ã.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
	‚Ä¢	–®–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ ‚Äî –Ω–µ –≤ –¥–≤–∏–∂–∫–µ: FlowEngine –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–ª–µ–π–ª–∏—Å—Ç–∞ –∏ placeholders; Orchestrator –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è (—É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å –æ–±—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º).
	‚Ä¢	execute_code ‚Äî –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ (FE-06), side-effects —Ç–æ–ª—å–∫–æ –≤ session.variables.
	‚Ä¢	–ï—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤–µ–¥—ë—Ç –∫ RUN_FORCE_CHECK / RESUME_PREVIOUS_TASK ‚Äî FlowEngine –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç —ç—Ç–æ–≥–æ –º–µ—Ç–∞—Å–æ—Å—Ç–æ—è–Ω–∏—è; –æ–Ω –≤—ã—á–∏—Å–ª—è–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
	‚Ä¢	–î–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ state_id –∏ intent_id —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–π response —Å –ø–ª–µ–π–ª–∏—Å—Ç–æ–º.
	‚Ä¢	–î–ª—è action: END_CALL –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è flags.ended = true.

‚∏ª

üß© –ó–∞–¥–∞—á–∞ FE-05 ‚Äî –î–∏–≥—Ä–µ—Å—Å–∏–∏ (FAQ) –∏ —Å–≤—è–∑–∫–∞ —Å IntentClassifier: –≥–ª—É–±–∏–Ω–∞, should_guide_back

–¶–µ–ª—å. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–ª–µ—á–µ–Ω–∏—è (FAQ) –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ —Å—Ç–µ–∫–µ: –ø–∞—É–∑–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–µ–ª–∏, –æ—Ç–≤–µ—Ç, –≤–æ–∑–≤—Ä–∞—Ç.

–ö–æ–Ω—Ç–µ–∫—Å—Ç
	‚Ä¢	–õ—é–±–æ–π –∏–Ω—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–∞–ø–∏—Ç—Å—è –Ω–∞ goal —Å is_digression: true, –¥–æ–ª–∂–µ–Ω:
	‚Ä¢	–ü–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é –∑–∞–¥–∞—á—É –≤ PAUSED (—Å return_state_id).
	‚Ä¢	–ü–æ–ª–æ–∂–∏—Ç—å –Ω–æ–≤—É—é FAQ-–∑–∞–¥–∞—á—É –Ω–∞ –≤–µ—Ä—à–∏–Ω—É —Å—Ç–µ–∫–∞.
	‚Ä¢	–í–µ—Ä–Ω—É—Ç—å next_state = goal.result_state (–Ω–∞–ø—Ä–∏–º–µ—Ä, info_company).
	‚Ä¢	–ï—Å–ª–∏ –≥–ª—É–±–∏–Ω–∞ —Å—Ç–µ–∫–∞ ‚â• 3 ‚Äî –≤–µ—Ä–Ω—É—Ç—å —Ñ–ª–∞–≥ should_guide_back: true. Orchestrator –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ –º—è–≥–∫—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É ‚Äú–≤–µ—Ä–Ω—ë–º—Å—è –∫ —Ä–∞—Å—á—ë—Ç—É‚Ä¶‚Äù.
	‚Ä¢	–ï—Å–ª–∏ FAQ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
	‚Ä¢	FlowEngine –Ω–µ –∏—â–µ—Ç –ø–æ –±–∞–∑–µ ‚Äî –æ–Ω —Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç. –ü–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É Orchestrator —É–∂–µ –ø–æ–ª—É—á–∏–ª –æ—Ç IntentClassifier.find_faq_answer(text) –æ—Ç–≤–µ—Ç (–∏–ª–∏ None).
	‚Ä¢	–ï—Å–ª–∏ FaqResult –µ—Å—Ç—å ‚Äî FlowEngine –≤–µ—Ä–Ω—ë—Ç state –¥–ª—è –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –æ—Ç–≤–µ—Ç–∞ (–∏–∑ dialogue_map) –∏ –ø–æ–º–µ—Ç–∏—Ç response.faq_text –¥–ª—è TTS (–ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É).

–§–∞–π–ª—ã
	‚Ä¢	flow_engine/digressions.md ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
	‚Ä¢	configs/goals.json ‚Äî –ø—Ä–∏–º–µ—Ä—ã is_digression —Ü–µ–ª–µ–π (–Ω–µ—Å–∫–æ–ª—å–∫–æ).
	‚Ä¢	flow_engine/test/test_digressions.md ‚Äî —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ (2‚Äì3 –≤–ª–æ–∂–µ–Ω–∏—è, –∑–∞—Ç–µ–º –≤–æ–∑–≤—Ä–∞—Ç).

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
	‚Ä¢	–ß—ë—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—É–∑—ã/–≤–æ–∑–≤—Ä–∞—Ç–∞.
	‚Ä¢	–ü–æ–¥–¥–µ—Ä–∂–∞–Ω —Ñ–ª–∞–≥ should_guide_back –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–ª—É–±–∏–Ω–∞.
	‚Ä¢	–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–∞–∫ FlowEngine –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç find_faq_answer (–µ—Å–ª–∏ –æ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç Orchestrator).

‚∏ª

üß© –ó–∞–¥–∞—á–∞ FE-06 ‚Äî –ü–µ—Å–æ—á–Ω–∏—Ü–∞ execute_code, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞

–¶–µ–ª—å. –û–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–Ω–∏-—Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–∑ dialogue_map.transitions[*].execute_code –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚Äú—Å–ª–æ–º–∞—Ç—å‚Äù –ø—Ä–æ—Ü–µ—Å—Å.

–ö–æ–Ω—Ç–µ–∫—Å—Ç
	‚Ä¢	–î–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ:
	‚Ä¢	–î–æ—Å—Ç—É–ø –∫ session.variables –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º entities.
	‚Ä¢	–û–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤ (str/float/int/bool).
	‚Ä¢	–í—ã—á–∏—Å–ª–µ–Ω–∏—è –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–Ω–∏–∫–∞–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤, IO, —Å–µ—Ç–∏).
	‚Ä¢	–ù—É–∂–Ω—ã:
	‚Ä¢	–ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ Python-–æ–±—ä–µ–∫—Ç–æ–≤.
	‚Ä¢	–ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, min/max/round –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é).
	‚Ä¢	–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Ç–∞–π–º–∞—É—Ç).
	‚Ä¢	–ü—Ä–æ—Ç–æ–∫–æ–ª –æ—à–∏–±–æ–∫: –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ ‚Üí FlowResult.status = EXECUTION_ERROR, —á–∏—Ç–∞–±–µ–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞.

–§–∞–π–ª—ã
	‚Ä¢	flow_engine/utils.md ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ—Å–æ—á–Ω–∏—Ü—ã –∏ —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
	‚Ä¢	flow_engine/test/test_execute_code.md ‚Äî –ø–æ–∑–∏—Ç–∏–≤/–Ω–µ–≥–∞—Ç–∏–≤ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Ç–∞–π–º–∞—É—Ç, –æ—à–∏–±–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞).
	‚Ä¢	–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –∫–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ª–æ–≥ (JSONL) —Å trace_id, goal_id, state_id, intent_id, ok/error, elapsed_ms.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
	‚Ä¢	–ß—ë—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–Ω—ã–π API –ø–µ—Å–æ—á–Ω–∏—Ü—ã –∏ —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫.
	‚Ä¢	–ü–æ–ª–µ–∑–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

‚∏ª

üß© –ó–∞–¥–∞—á–∞ FE-07 ‚Äî E2E-–Ω–∞–±–æ—Ä —Å—Ü–µ–Ω–∞—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ FlowEngine (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)

–¶–µ–ª—å. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö –¥–∏–∞–ª–æ–≥–∞: –ø—Ä—ã–∂–∫–∏, FAQ-–≤—Å—Ç–∞–≤–∫–∏, —Ñ–æ—Ä—Å-—Ä–µ–∂–∏–º, –æ—Ç–∫–∞–∑.

–ö–æ–Ω—Ç–µ–∫—Å—Ç

–ù–∞–º –Ω—É–∂–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–∞–Ω–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π ‚Äú–∫–æ—Ä–º–∏—Ç‚Äù FlowEngine –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é (intent_id, entities?, meta?) –∏ —Å–≤–µ—Ä—è–µ—Ç FlowResult –∏ —ç–≤–æ–ª—é—Ü–∏—é session_state.task_stack.

–§–∞–π–ª—ã
	‚Ä¢	flow_engine/test/e2e_scenarios.md ‚Äî –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ –æ–∂–∏–¥–∞–µ–º—ã—Ö —à–∞–≥–æ–≤.
	‚Ä¢	flow_engine/test_data/:
	‚Ä¢	goals_e2e.json
	‚Ä¢	dialogue_map_e2e.json
	‚Ä¢	sessions/*.json ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–µ —Å—Ä–µ–∑—ã session_state.variables –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
	1.	–ù–µ—Ç–µ—Ä–ø–µ–ª–∏–≤—ã–π –ø—Ä—ã–∂–æ–∫: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ, ask_cost ‚Üí –ø–ª–∞–Ω provide_total_price ‚Üí —Ñ–æ—Ä—Å-–≤–æ–ø—Ä–æ—Å—ã ‚Üí —Å–≤–æ–¥–∫–∞.
	2.	–î–≤–µ FAQ –ø–æ–¥—Ä—è–¥: ask_company ‚Üí ask_robot ‚Üí –≤–æ–∑–≤—Ä–∞—Ç ‚Üí –≤–≤–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è ‚Üí RUN_FORCE_CHECK ‚Üí —Å–≤–æ–¥–∫–∞.
	3.	–ü–µ—Ä–µ–¥—É–º–∞–ª: –ø–æ—Å–ª–µ —Å–±–æ—Ä–∞ —á–∞—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö ‚Üí —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–Ω—Ç ‚Üí refusal_end.
	4.	–ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–Ω–µ–Ω–∏—è: —Å–Ω–∞—á–∞–ª–∞ wants_inner_insurance=true, –∑–∞—Ç–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç ‚Äú–ø–µ—Ä–µ–¥—É–º–∞–ª‚Äù ‚Üí —É—Å–ª–æ–≤–Ω—ã–µ —Å–ª–æ—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª–∏—Å—å, inner_amount —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ –Ω—É–∂–µ–Ω.
	5.	–ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∏–Ω—Ç–µ–Ω—Ç –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ FAQ: –ø—Ä–∏ –≤–≤–æ–¥–µ —á–∏—Å–ª–∞ –≤ FAQ-–∑–∞–¥–∞—á–µ ‚Äî –∏–≥–Ω–æ—Ä/—Ä—É–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–æ–º (–æ–ø–∏—Å–∞—Ç—å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: –º—è–≥–∫–∏–π pop –ø—Ä–∏ —è–≤–Ω–æ–º provide_number –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ return_to_main_goal).

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
	‚Ä¢	–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è ‚Äî —Ç–∞–±–ª–∏—Ü–∞: –≤—Ö–æ–¥ ‚Üí –æ–∂–∏–¥–∞–µ–º—ã–π next_state/flags/stack.
	‚Ä¢	–û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å: —Ñ–æ—Ä–º–∏—Ä—É–µ–º JSONL —Å —à–∞–≥–∞–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞), –ø—Ä–∏–≥–æ–¥–Ω—É—é –¥–ª—è Kibana/Grafana.

‚∏ª

–û–±—â–∏–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –∏ –º–µ—Ç—Ä–∏–∫–∞–º
	‚Ä¢	–°—Ç—Ä–æ–≥–æ JSON-driven: –Ω–∏–∫–∞–∫–∏—Ö —Ö–∞—Ä–¥–∫–æ–¥–æ–≤ –ø–æ –∏–Ω—Ç–µ–Ω—Ç–∞–º/—Å–æ—Å—Ç–æ—è–Ω–∏—è–º. –í—Å—ë ‚Äî —á–µ—Ä–µ–∑ goals.json/dialogue_map.json.
	‚Ä¢	–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞: –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ process_event –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è: trace_id, intent_id, goal_id(–µ—Å–ª–∏ –µ—Å—Ç—å), state_id(–µ—Å–ª–∏ –µ—Å—Ç—å), –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, next_state, —Ñ–ª–∞–≥–∏, —Å—Ç–µ–∫ (–∫—Ä–∞—Ç–∫–∏–π –≤–∏–¥), elapsed_ms.
	‚Ä¢	–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –µ—Å–ª–∏ JSON –∏—Å–ø–æ—Ä—á–µ–Ω (–Ω–µ—Ç result_state —É —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ —Ç. –ø.), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º EXECUTION_ERROR –∏ ‚Äú–∞–≤–∞—Ä–∏–π–Ω–æ–µ‚Äù —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è Orchestrator (–ø—É—Å—Ç—å –æ–Ω —Å—ã–≥—Ä–∞–µ—Ç —Ç–µ—Ö-—Ñ–∏–ª–ª–µ—Ä –∏ –∑–∞–≤–µ—Ä—à–∏—Ç –∑–≤–æ–Ω–æ–∫).
	‚Ä¢	–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å: –Ω–æ–≤—ã–µ —Ü–µ–ª–∏/FAQ/—Ñ–æ—Ä—Å-–∏–Ω—Ç–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ JSON; –¥–≤–∏–∂–æ–∫ –Ω–µ –º–µ–Ω—è–µ–º.

‚∏ª

–ö–∞–∫ –ø—Ä–æ–≥–æ–Ω—è—Ç—å —Ç–µ—Å—Ç—ã (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)
	1.	–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å configs/goals.json –∏ configs/dialogue_map.json –ø–æ –ø—Ä–∏–º–µ—Ä–∞–º –∏–∑ –∑–∞–¥–∞—á.
	2.	–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã (–æ–ø–∏—Å–∞–Ω—ã –≤ FE-01).
	3.	–ü—Ä–æ–≥–Ω–∞—Ç—å unit-–Ω–∞–±–æ—Ä: —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (FE-02), —Ñ–æ—Ä—Å-—Ä–µ–∂–∏–º (FE-03), –¥–∏–∞–ª–æ–≥–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã (FE-04), –¥–∏–≥—Ä–µ—Å—Å–∏–∏ (FE-05), –ø–µ—Å–æ—á–Ω–∏—Ü—É (FE-06).
	4.	–ü—Ä–æ–≥–Ω–∞—Ç—å E2E —Å—Ü–µ–Ω–∞—Ä–∏–∏ (FE-07) ‚Äî —Å–≤–µ—Ä–∏—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–µ next_state, flags, –∫—Ä–∞—Ç–∫–∏–µ —Å—Ä–µ–∑—ã —Å—Ç–µ–∫–∞.
	5.	–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ JSONL: –µ—Å—Ç—å trace, —à–∞–≥–∏, –æ—à–∏–±–∫–∏ –ø–æ–º–µ—á–µ–Ω—ã, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è < –∑–∞–¥–∞–Ω–Ω—ã—Ö –±—é–¥–∂–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, < 3‚Äì5 –º—Å –Ω–∞ –≤—ã–∑–æ–≤ FE –ø—Ä–∏ mock-—É—Å–ª–æ–≤–∏—è—Ö).

‚∏ª